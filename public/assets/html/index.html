
<html>

<head>
	<meta charSet="utf8"/>
	<title>Devapt TestBus Home</title>
	
	<link rel="icon" type="image/png" href="/assets/img/favico.png"/>

	<link type='text/css'  rel="stylesheet" href="/assets/css/normalize.css" media="all" />

	<style type='text/css'>
		body {
			margin: 0; /* pour Ã©viter les marges */
		}
		#content {
			min-width:400px;
			min-height:300px;
			width:80%;
			height:80%;
			margin-left: auto;
			margin-right: auto;
		}
		#id_out_ping_master,#id_out_ping_node_a,#id_out_ping_node_b,#id_out_ping_node_c {
			min-width:300px;
		}
		#logs {
			max-height:30%;
		}
		#logs.table.tbody.td {
			padding: 5px;
		}

		table {
			margin-bottom:20px;
		}

		td {
			padding:5px;
		}
	</style>
</head>


<body>

<header>
	<center>
		<h1>TestBus</h1>
	</center>
</header>

<script>window.__INITIAL_STATE__ = {
	"credentials":{
		"tenant":"tenantA",
		"env":"dev",
		"application":"testbus",

		"token":"",
		"user_name":"",
		"user_pass_digest":"",
		
		"ts_login":0,
		"ts_expiration":0,

		"errors_count":0,
		"renew_count":0,

		"hash":undefined
	},
	"commands":{}
}
</script>


<script type="text/javascript">

	var logs_are_enabled = false

	function fn_enable_logs()
	{
		console.log('call:fn_enable_logs')
		if (logs_are_enabled)
		{
			return
		}
		logs_are_enabled = true

		var logs_svc_promise = devapt_get_service('logs', logs_svc_cfg)
		devapt_request_service(logs_svc_promise, 'devapt-subscribe', undefined)
		devapt_subscribe_service(logs_svc_promise, undefined, get_out_log('logs') )
	}

	function fn_disable_logs()
	{
		console.log('call:fn_disable_logs')
		if (! logs_are_enabled)
		{
			return
		}
		var logs_svc_promise = devapt_get_service('logs', logs_svc_cfg)
		logs_svc_promise.then(
			function(svc)
			{
				svc['post'].unsubscribes.forEach(
					function(unsubscribe)
					{
						unsubscribe()
					}
				)
			}
		)
		logs_are_enabled = false
	}

	function fn_ping(arg_target)
	{
		// console.log('call:fn_ping')
		get_out_ping('id_out_ping_' + arg_target, 'Ping emitted')()
		var ping_svc_promise = devapt_get_service('pingpong', ping_svc_cfg)
		devapt_request_service(ping_svc_promise, 'devapt-ping', { target:arg_target }, get_out_ping('id_out_ping_' + arg_target, 'Pong received'))
	}
	
	function fn_ping_master()
	{
		fn_ping('master')
	}
	
	function fn_ping_node_a()
	{
		fn_ping('node_a')
	}
	
	function fn_ping_node_b()
	{
		fn_ping('node_b')
	}
	
	function fn_ping_node_c()
	{
		fn_ping('node_c')
	}


	function fn_topology_tenants_names()
	{
		console.log('call:fn_topology_tenants_names')
		var svc_promise = devapt_get_service('topology', topology_svc_cfg)
		devapt_request_service(svc_promise, "devapt-deployed-tenants-names", undefined, function(response){ console.log('fn_topology_tenants_names:response results', response.results)})
	}

	function fn_topology_tenants_infos()
	{
		console.log('call:fn_topology_tenants_infos')
		var svc_promise = devapt_get_service('topology', topology_svc_cfg)
		devapt_request_service(svc_promise, "devapt-deployed-tenants-infos", undefined, function(response){ console.log('fn_topology_tenants_infos:response results', response.results)})
	}

	function fn_topology_tenant_infos(arg_tenant_name)
	{
		console.log('call:fn_topology_tenant_infos')
		var svc_promise = devapt_get_service('topology', topology_svc_cfg)
		devapt_request_service(svc_promise, "devapt-deployed-tenant-infos", arg_tenant_name, function(response){ console.log('fn_topology_tenant_infos:response results', response.results)})
	}


	function fn_topology_services_names(arg_tenant_name)
	{
		console.log('call:fn_topology_services_names')
		var svc_promise = devapt_get_service('topology', topology_svc_cfg)
		devapt_request_service(svc_promise, "devapt-deployed-services-names", arg_tenant_name, function(response){ console.log('fn_topology_services_names:response results', response.results)})
	}

	function fn_topology_services_infos(arg_tenant_name)
	{
		console.log('call:fn_topology_services_infos')
		var svc_promise = devapt_get_service('topology', topology_svc_cfg)
		devapt_request_service(svc_promise, "devapt-deployed-services-infos", arg_tenant_name, function(response){ console.log('fn_topology_services_infos:response results', response.results)})
	}

	function fn_topology_service_infos(arg_tenant_name, arg_svc_name)
	{
		console.log('call:fn_topology_service_infos')
		var svc_promise = devapt_get_service('topology', topology_svc_cfg)
		devapt_request_service(svc_promise, "devapt-deployed-service-infos", [arg_tenant_name, arg_svc_name], function(response){ console.log('fn_topology_service_infos:response results', response.results)})
	}
</script>

<div id="content">
	<center>
		<!-- PING -->
		<table>
			<tbody>
				<tr>
					<td>
						<button id="id_button_ping_master" onclick="fn_ping_master()">Ping master</button>
					</td>
					<td>
						<button id="id_button_ping_node_a" onclick="fn_ping_node_a()">Ping Node A</button>
					</td>
					<td>
						<button id="id_button_ping_node_b" onclick="fn_ping_node_b()">Ping Node B</button>
					</td>
					<td>
						<button id="id_button_ping_node_c" onclick="fn_ping_node_c()">Ping Node C</button>
					</td>
				</tr>
				<tr>
					<td>
						<textarea id="id_out_ping_master" readonly="true"></textarea>
					</td>
					<td>
						<textarea id="id_out_ping_node_a" readonly="true"></textarea>
					</td>
					<td>
						<textarea id="id_out_ping_node_b" readonly="true"></textarea>
					</td>
					<td>
						<textarea id="id_out_ping_node_c" readonly="true"></textarea>
					</td>
				</tr>
			</tbody>
		</table>


		<!-- TOPOLOGY -->
		<table>
			<tbody>
				<tr>
					<td>
						<button id="id_button_topology_tenants_names" onclick="fn_topology_tenants_names()">Topology tenants names</button>
					</td>
					<td>
						<button id="id_button_topology_tenants_infos" onclick="fn_topology_tenants_infos()">Topology tenants infos</button>
					</td>
					<td>
						<button id="id_button_topology_tenant_infos" onclick="fn_topology_tenant_infos('tenantA')">Topology infos for tenantA</button>
					</td>
					<td>
						<button id="id_button_topology_services_names" onclick="fn_topology_services_names('tenantA')">Topology services names</button>
					</td>
					<td>
						<button id="id_button_topology_services_infos" onclick="fn_topology_services_infos('tenantA')">Topology services infos</button>
					</td>
					<td>
						<button id="id_button_topology_service1_infos" onclick="fn_topology_service_infos('tenantA', 'pingpong')">Topology infos for service PingPong</button>
					</td>
				</tr>
				<tr>
					<td>
						<textarea id="id_out_topology_tenants_names" readonly="true"></textarea>
					</td>
					<td>
						<textarea id="id_out_topology_tenants_infos" readonly="true"></textarea>
					</td>
					<td>
						<textarea id="id_out_topology_tenantA_infos" readonly="true"></textarea>
					</td>
					<td>
						<textarea id="id_out_topology_services_names" readonly="true"></textarea>
					</td>
					<td>
						<textarea id="id_out_topology_services_infos" readonly="true"></textarea>
					</td>
					<td>
						<textarea id="id_out_topology_service1_infos" readonly="true"></textarea>
					</td>
				</tr>
			</tbody>
		</table>


		<!-- LOGS -->
		<table>
			<tbody>
				<tr>
					<td>
						<button id="id_button_enable_logs" onclick="fn_enable_logs()">Start logs</button>
					</td>
					<td>
						<button id="id_button_disable_logs" onclick="fn_disable_logs()">Stop logs</button>
					</td>
				</tr>
			</tbody>
		</table>
		<table id="logs">
			<thead>
				<tr>
					<td>Timestamp</td>
					<td>Level</td>
					<td>Type</td>
					<td>Context</td>
					<td>Source</td>
					<td>Log</td>
				</tr>
			</thead>
			<tbody>
			</tbody>
		</table>
	</center>
</div>


<script type="text/javascript" src="/socket.io/socket.io.js"></script>
<script type="text/javascript" src="/assets/js/vendor/browser.min.js"></script>
<script type="text/javascript" src="/assets/js/devapt-core-browser.js"></script>
<script type="text/javascript" src="/assets/js/devapt-bootstrap.js"></script>
<script type="text/javascript" src="/assets/js/app.js"></script>


<footer>
	<div class="row">
		<center>
			<p>
				<a href="https://github.com/lucbories/devapt-app-testbus/issues">Issues</a>
			</p>
		</center>
	</div>
</footer>


</body>


</html>